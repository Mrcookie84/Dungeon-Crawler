using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Chest : MonoBehaviour
{
    [Header("Selection ref")]
    [SerializeField] private GameObject canvas;
    [SerializeField] private GameObject selectionScreen;
    [SerializeField] private GameObject itemSelector;

    [Header("Item")]
    [SerializeField] private List<ItemData> itemPool;
    [SerializeField] private int maxSelected;

    private GameObject currentSelecMenu;
    private int leftToSelect;
    private bool opened;
    private bool canBeOpened;

    public void OpenChest()
    {
        if (opened || !canBeOpened) return;
        opened = true;

        GameObject selecScreenInstance = Instantiate(selectionScreen, canvas.transform);
        currentSelecMenu = selecScreenInstance;

        // Ajout items
        foreach (ItemData item in itemPool)
        {
            GameObject iSelecInstance = Instantiate(itemSelector, selecScreenInstance.transform.GetChild(0));

            ItemChestSelection selection = iSelecInstance.GetComponent<ItemChestSelection>();
            selection.SetItem(item, this);
        }

        leftToSelect = maxSelected;

        // Affichage du nombre de sélection
        TMPro.TextMeshProUGUI leftToSelGUI = currentSelecMenu.transform.GetChild(2).GetComponent<TMPro.TextMeshProUGUI>();
        leftToSelGUI.text = leftToSelect.ToString();
    }

    public void ItemSelected()
    {
        leftToSelect--;

        // Affichage du nombre de sélection
        TMPro.TextMeshProUGUI leftToSelGUI = currentSelecMenu.transform.GetChild(2).GetComponent<TMPro.TextMeshProUGUI>();
        leftToSelGUI.text = leftToSelect.ToString();

        if (leftToSelect <= 0)
        {
            Destroy(currentSelecMenu);
        }
    }

    private void OnTriggerEnter2D(Collider2D col)
    {
        if (col.tag == "Player")
        {
            Debug.Log("Chest can be opened !");
            canBeOpened = true;
        }
    }

    private void OnTriggerExit2D(Collider2D col)
    {
        if (col.tag == "Player")
        {
            Debug.Log("Chest can no longer be opened...");
            canBeOpened = false;
        }
    }

    /*
                                                %%%%                                                
                                            %%%#***#%%%%                                            
                                        %%%##**********#%%%%                                        
                                     %%%#*****************#%%%%                                     
                                 %%%#*******++++++************#%%%%                                 
                             %%%##*****++++++++++++******++*******#%%%%                             
                          %%%#**********+++++++++++*******+++++++****#%%%%                          
                       %%#******+++++++++++++++++++++++******++++++******#%%%                       
                   %%##****++++++++++++++++++**+++++*+++++************++*****#%%%                   
               %%##*******++++++++++++++++++*************+++++****++++++++++****#%%%%               
           %%%#******+++******++++++++++++++++++*************++++++++***++++++******#%%%%           
        %%%********+++++++++*+++++++++++++++++++++++*+++++*******+++***+++++++++++*****#%%%%        
     %%%#*****+++++++++++++++++*++++++******++++++++++++++++++++++++++++++++++++++++******#%%%%     
     %%%%%%#******++++++++++*******++++++*******++++******++++++++++++++++++++++++*****#%%%%%%@     
     %#**#%%%%%******++++++++++++***++++++******+++++++++++++++******++++++++*******%%%%%%####@     
     %#******#%%%%#******++++++++++++++*****+++++++++++++++++++++++******+******#%%%%%%#######@     
     %#*********##%%%##******+++++++++++*+++++++++++++++++++++++++++++******#%%%%%%###########@     
     %%*************#%%%%#******+++++++++++++++++*+++++++++++++++********%%%%%%%#############%@     
     %%*****************#%%%%#******+++***+++++*******++++++++++*****#%%%%%%#################%@     
     %%********************##%%%##************+++++*******+******##%%%%%%####################%@     
     %%##**********************#%%%%#************+++++*******##%%%%%%########################%@     
     %%######************###******##%%%%#*****************#%%%%%%############################%@     
     %%%%%#######*****##*#####********#%%%%%**********#%%%%%%#############################%%%@@     
     %%%%%%%%######***##*===*************##%%%%#**##%%%%%%############################%%%%%%%%@     
     %%###%%%%%%%##***##*===+++***************#%%%%%%%############################%%%%%%%%%%#%@     
     %%######%%%%%%%#*##*===+++*##***************%%%###########################%%%%%%%%%#####%@     
     %%#*########%%%%%%%#===***###***************%%%#######################%%%%%%%%%%########%@     
     %%#**###########%%%%++=***#%%#**************%%%###################%%%%%%%%%%%###########%@     
     %#****#############%+++***%%%###************%%%################%%%%%%%%%%%%%%###########%@     
     %#*******###########*++***%%%%##***********#%%%############%%%%%%%%%%%%%%%##############%@     
     %%#**********#######*++***%%%%%%%%#********#%%%########%%%%%%%%%%%%%%%%#################%@     
     %%#**************######***%%%#%%%%%%%##****#%%%####%%%%%%%%%%###%%%#####################%@     
     %#****************#######%%%%#####%%%%%%%#*#%%%#%%%%%%%%%###############################%@     
     %%*********************###############%%%%%%@%%%%%%%%%%%################################%@     
     %%************************###############%%%@%%%%%%#%%%%################################%@     
     %%*****************************#############@%%#########################################%@     
     %#*********************************#########%%%#########################################%@     
     %#*************************************#####%%%#########################################%@     
     %%#**************************************###%%%#########################################%@     
     %%#****************************************#%%%#########################################%@     
     %%*****************************************#%%%#########################################%@     
     %%***###*********************************###%%%#########################################%@     
     %%%%#######******************************###%%%######################################%@@@@     
        @%%%%######*****************************#%%%###################################@@@@@        
           @%%%%%##*****************************#%%%###############################%@@@@@           
               @%%%%#****###******************###%%%###########################%%@@@@               
                   %%%%%####*******************##%%%#######################%%@@@@                   
                       %%%%%******#*************#%%%####################%@@@@                       
                          %%%%%#**###***********#%%%################%%@@@@                          
                             @%%%%%##*********###%%%############%%@@@@@                             
                                 @%%%%##******###%%%########%%@@@@@                                 
                                     @%%%%#***###%%%#####%@@@@@                                     
                                        @%%%%%###%%%##%@@@@@                                        
                                            @%%%%@%@@@@@                                            
                                                @@@@                                                
     */
}
